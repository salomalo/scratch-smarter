(function(){"use strict";jQuery(document).ready(function(a){var b,c,d,e;if(e=null!=(c=window.wc_memberships_admin)?c:{},b=null!=(d=window.pagenow)?d:"","wc_membership_plan"===b)return a.each(["content-restriction","product-restriction","purchasing-discount"],function(a,b){return e.initializeRuleset(b)}),e.initializeEnhancedSelect(a(".js-ajax-select-products"),{action:"woocommerce_json_search_products_and_variations",security:e.search_products_nonce,screen:"wc_membership_plan"}),a(".js-access-method-selector").on("change",function(b){var c,d,e,f,g,h,i;return i=a(".js-access-method-selector:checked",".plan-access-method-field").val(),g=a(this).closest(".options_group"),f=g.find(".js-show-if-access-method-purchase"),d=a(".misc-pub-grant-access"),c=a("span.grant-access-purchase"),e=a("span.grant-access-signup"),h=a("#wp-WC_Memberships_User_Membership_Renewal_Reminder_Email-wrap").parent(".options_group"),"purchase"===i?(f.removeClass("hide"),d.show(),c.show(),e.hide(),h.show()):("signup"===i?(d.show(),e.show(),c.hide()):d.hide(),f.addClass("hide"),h.hide())}).change(),a(".plan-access-length-field").on("change",".js-access-length-type-selector",function(b){var c,d,e,f,g;if(g=a(".js-access-length-type-selector:checked",".plan-access-length-field").val(),d=a(this).closest(".form-field"),f=d.find(".js-show-if-access-length-type-specific"),e=d.find(".js-show-if-access-length-type-fixed"),"specific"===g?(f.removeClass("hide"),e.addClass("hide")):"fixed"===g?(f.addClass("hide"),e.removeClass("hide")):(f.addClass("hide"),e.addClass("hide")),c=d.find(".access_length-amount"),c.val()||c.val(1),a(this).hasClass("js-access-length-type"))return c.focus()}),a(".js-plan-access-set-date").datepicker({defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,showOn:"button",buttonImage:e.calendar_image,buttonImageOnly:!0}),a("ul.wc-tabs").show(),a("div.panel-wrap").each(function(){return a(this).find("div.panel:not(:first)").hide()}),a("ul.wc-tabs a").click(function(){var b,c,d;switch(d=a(this).attr("href"),c=a(this).closest("div.panel-wrap"),b=a("#wc-memberships-membership-plan-email-content-merge-tags"),a("ul.wc-tabs li",c).removeClass("active"),a(this).parent().addClass("active"),a("div.panel",c).hide(),a(d).show(),"#membership-plan-email-content"===a(this).attr("href")?b.show():b.hide(),a(".js-memberships-restrict-notice").hide(),d){case"#membership-plan-data-restrict-content":a(".js-memberships-restrict-content-notice").show();break;case"#membership-plan-data-restrict-products":a(".js-memberships-restrict-products-notice").show()}return!1}),a("ul.wc-tabs li:visible").eq(0).find("a").click(),a("button.grant-access-modal").on("click",function(b){var c,d;return b.preventDefault(),c=a(this),d={action:"wc_memberships_get_batch_job",security:e.get_memberships_batch_job_nonce,job_name:"grant_retroactive_access",job_id:c.data("plan-id"),process:!0},a.post(e.ajax_url,d,function(a){return a.success?new WC_Memberships_Modal_View_Grant_Access_Membership_Plan({data:{job:null,error:null,plan:{id:c.data("plan-id"),name:c.data("plan-name"),access:c.data("plan-access")}}}):console.log(a)})}),window.WC_Memberships_Modal_View_Grant_Access_Membership_Plan=WC_Memberships_Modal_View.extend({template_id:"wc-memberships-modal-grant-access-membership-plan",initialize:function(b){var c,d,f,g,h,i,j;return j=this,c=b.data.job?b.data.job:null,f=b.data.error?b.data.error:null,h=parseInt(b.data.plan.id,10),i=b.data.plan.name,g=b.data.plan.access,WC_Memberships_Modal_View_Grant_Access_Membership_Plan.__super__.initialize.apply(this,arguments),j.unblock(),c&&c.id?"completed"===c.status||f?window.onbeforeunload=null:(f||(window.onbeforeunload=function(){return e.i18n.confirm_stop_batch_job}),d={action:"wc_memberships_get_batch_job",security:e.get_memberships_batch_job_nonce,job_name:c.name,job_id:c.id,process:!0},a.post(e.ajax_url,d,function(a){return a.data?(j.close(),new WC_Memberships_Modal_View_Grant_Access_Membership_Plan({data:{job:a.success?a.data:null,error:a.success?null:a.data,plan:{id:h,name:i,access:g}}})):console.log(a)})):a("#btn-start").on("click",function(b){return b.preventDefault(),j.block(),d={action:"wc_memberships_grant_retroactive_access",security:e.grant_retroactive_access_nonce,plan_id:h},a.post(e.ajax_url,d,function(a){return a.data?(j.close(),new WC_Memberships_Modal_View_Grant_Access_Membership_Plan({data:{job:a.success?a.data:null,error:a.success?null:a.data,plan:{id:h,name:i,access:g}}})):console.log(a)})})}})})}).call(this);