(function(){"use strict";jQuery(document).ready(function(a){var b,c,d,e,f,g,h,i,j,k,l,m;if(m=null!=(j=window.wc_memberships_admin)?j:{},i=null!=(k=window.pagenow)?k:"","admin_page_wc_memberships_import_export"===i&&(a(".js-user-membership-date").datepicker({defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,showOn:"button",buttonImage:m.calendar_image,buttonImageOnly:!0}),c=a("#wc_memberships_members_csv_import_create_new_user_memberships"),h=a("#wc_memberships_members_csv_import_merge_existing_user_memberships"),b=a("#wc_memberships_members_csv_import_allow_memberships_transfer").closest("fieldset"),e=a("#wc_memberships_members_csv_import_create_new_users"),d=e.closest("fieldset"),g=a("#wc_memberships_members_csv_import_new_user_email_notification").closest("fieldset"),f=a("#wc_memberships_members_csv_import_default_start_date").closest("tr"),c.on("change",function(b){return a(this).is(":checked")?(f.show(),d.show(),e.is(":checked")?g.show():g.hide()):(f.hide(),d.hide(),g.hide())}).trigger("change"),e.on("change",function(b){return a(this).is(":checked")&&c.is(":checked")?g.show():g.hide()}).trigger("change"),h.on("change",function(c){return a(this).is(":checked")?b.show():b.hide()}).trigger("change")),"admin_page_wc_memberships_import_export"===i||"edit-wc_user_membership"===i||"wc_user_membership"===i)return a("button#wc-memberships-import-export-trigger").on("click",function(b){return b.preventDefault(),l(a(this).data("action-id"),a(this).data("action-title"))}),a("#doaction, #doaction2").on("click",function(b){var c;return b.preventDefault(),"export"!==a(this).prev("select").val()||(c=a('input[type="checkbox"][name="post\\[\\]"]:checked').map(function(){return this.value}).get(),l("export",m.i18n.export_user_memberships,0===c.length?"undefined":c))}),l=function(b,c,d){var e,f,g,h,i,j;return null==d&&(d=[]),"import"===b?(e=a("#wc-memberships-import-export-trigger"),f=e.next("span"),i=a("#wc_memberships_members_csv_import_file").prop("files"),h=i.length>0?i[0]:null,h?(e.prop("disabled",!0),f.addClass("is-active"),j=new FormData,j.append("action","wc_memberships_import_user_memberships"),j.append("security",m.import_user_memberships_nonce),j.append("file",h),j.append("create_new_memberships",a("#wc_memberships_members_csv_import_create_new_user_memberships").is(":checked")?"yes":"no"),j.append("merge_existing_memberships",a("#wc_memberships_members_csv_import_merge_existing_user_memberships").is(":checked")?"yes":"no"),j.append("allow_memberships_transfer",a("#wc_memberships_members_csv_import_allow_memberships_transfer").is(":checked")?"yes":"no"),j.append("create_new_users",a("#wc_memberships_members_csv_import_create_new_users").is(":checked")?"yes":"no"),j.append("notify_new_users",a("#wc_memberships_members_csv_import_new_user_email_notification").is(":checked")?"yes":"no"),j.append("timezone",a("#wc_memberships_members_csv_import_timezone").val()),j.append("default_start_date",a("#wc_memberships_members_csv_import_default_start_date").val()),j.append("fields_delimiter",a("#wc_memberships_members_csv_import_fields_delimiter").val()),a.ajax({url:m.ajax_url,type:"POST",data:j,contentType:!1,processData:!1,success:function(a){return e.prop("disabled",!1),f.removeClass("is-active"),new WC_Memberships_Modal_Import_Export_User_Memberships({data:{job:a.success&&a.data?a.data:{},error:!a.success&&a.data?a.data:null,action:{id:b,title:c}}})},error:function(a){return e.prop("disabled",!1),f.removeClass("is-active"),new WC_Memberships_Modal_Import_Export_User_Memberships({data:{job:null,error:a.data?a.data:null,action:{id:b,title:c}}})}})):alert(m.i18n.import_file_missing)):"export"===b?(g={action:"wc_memberships_export_user_memberships",security:m.export_user_memberships_nonce,export_params:{user_membership_ids:d,plan_ids:a("#wc_memberships_members_csv_export_plan").val(),plan_statuses:a("#wc_memberships_members_csv_export_status").val(),start_date_from:a("#wc_memberships_members_csv_export_start_date_from").val(),start_date_to:a("#wc_memberships_members_csv_export_start_date_to").val(),end_date_from:a("#wc_memberships_members_csv_export_end_date_from").val(),end_date_to:a("#wc_memberships_members_csv_export_end_date_to").val()}},a.post(m.ajax_url,g,function(a){return a.data?new WC_Memberships_Modal_Import_Export_User_Memberships({data:{job:a.success?a.data:null,error:a.success?null:a.data,action:{id:b,title:c}}}):console.log(a)})):void 0},window.WC_Memberships_Modal_Import_Export_User_Memberships=WC_Memberships_Modal_View.extend({template_id:"wc-memberships-modal-import-export-user-memberships",initialize:function(b){var c,d,e,f,g;if(g=this,c=b.data.action,d=b.data.job?b.data.job:null,f=b.data.error?b.data.error:null,WC_Memberships_Modal_Import_Export_User_Memberships.__super__.initialize.apply(this,arguments),a("#wc-memberships-modal-import-export-user-memberships").find("h1").text(c.title),g.unblock(),f&&(window.onbeforeunload=null),d){if(window.onbeforeunload=function(){return"export"===c.id?m.i18n.confirm_export_cancel:"import"===c.id?m.i18n.confirm_import_cancel:void 0},"completed"!==d.status)return e={action:"wc_memberships_get_batch_job",security:m.get_memberships_batch_job_nonce,job_name:d.name,job_id:d.id,process:!0},a.post(m.ajax_url,e,function(a){return a.data?(g.close(),new WC_Memberships_Modal_Import_Export_User_Memberships({data:{job:a.success?a.data:null,error:a.success?null:a.data,action:{id:c.id,title:c.title}}})):console.log(a)});if(window.onbeforeunload=null,"export"===c.id&&parseInt(d.results.exported,10)>0&&d.file_url)return window.location.href=d.file_url}}})})}).call(this);